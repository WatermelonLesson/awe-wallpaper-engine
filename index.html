<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<title>Abstract Wallpaper Engine</title>
		
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<link rel="icon" href="favicon.ico" type="image/x-icon">
	</head>
	
	<body><!-- rgb(253, 235, 187) : nice background colour -->
		<div class="bg-image">
			<main>
				<h1>Hello, world!</h1>
				
				<form class="">
					<label for="width">Width: </label>
					<input type="number" value="1920" id="width" min="1" max="9999"><br>
					
					<label for="height">Height: </label>
					<input type="number" value="1080" id="height" min="1" max="9999"><br>
					
					<label for="boxes">Number of Boxes: </label>
					<input type="number" id="boxes" min="0" max="1000" value="10"><br>
					
					<label for="circles">Number of Circles: </label>
					<input type="number" id="circles" min="0" max="100" value="20"><br>
					
					<label for="red">Red: </label>
					<input type="range" id="red" min="0" max="255" value="1000"><br>
					
					<label for="green">green: </label>
					<input type="range" id="green" min="0" max="255" value="1000"><br>
					
					<label for="blue">blue: </label>
					<input type="range" id="blue" min="0" max="255" value="1000"><br>
					
					<label for="animate">Animate?</animate>
					<input type="checkbox" id="animate">
					
					<input type="submit" name="submit">
				</form>
				
				<p>Click <a href="#">here to download</a>.</p>
				
				<button class="refresh">Refresh</button>
				
				<canvas width="500px" height="800px"></canvas>
			</main>
		</div>
		
		<script>
			const CANVAS_ELEMENT = document.querySelector('canvas');
			const CANVAS_CONTEXT = CANVAS_ELEMENT.getContext('2d');
			
			CANVAS_ELEMENT.width = document.querySelector("input#width").value;
			CANVAS_ELEMENT.height = document.querySelector("input#height").value;
			
			let number_of_boxes = document.querySelector("input#boxes").value;
			let number_of_circles = document.querySelector("input#circles").value;
			
			let interval = "";
			
			lame();

			function randomColour() {
				let r = Math.floor(Math.random() * 255);
				let g = Math.floor(Math.random() * 255);
				let b = Math.floor(Math.random() * 255);
				let a = Math.random();
				
				// console.log([r, g, b, a]);
				
				return [r, g, b, a];
			}
			
			function lame() {
				CANVAS_CONTEXT.clearRect(0, 0, CANVAS_ELEMENT.width, CANVAS_ELEMENT.height);
				
				for (i = 0; i < number_of_boxes + number_of_circles; i++)
				{
					let x = Math.floor(Math.random() * CANVAS_ELEMENT.width);
					let y = Math.floor(Math.random() * CANVAS_ELEMENT.height);
					
					let colour = randomColour();
					CANVAS_CONTEXT.fillStyle = "rgba(" + colour[0] + ", " + colour[1] + ", " + colour[2] +", " + colour[3] + ")";
					
					if (i < number_of_boxes) {
						let width = Math.floor(Math.random() * 250);
						let height = Math.floor(Math.random() * 550);
						CANVAS_CONTEXT.fillRect(x, y, width, height);
					}
					
					if (i < number_of_circles) {
						CANVAS_CONTEXT.beginPath();
						
						let radius = Math.floor(Math.random() * 250);
						let startAngle = 0;
						let endAngle = Math.random() * (2 * Math.PI);
					
						CANVAS_CONTEXT.arc(x, y, radius, startAngle, endAngle);
						CANVAS_CONTEXT.fill();
					}
				}
				
				document.querySelector('div.bg-image').style.backgroundImage = "url(" + CANVAS_ELEMENT.toDataURL() + ")";
				document.querySelector('a').href = CANVAS_ELEMENT.toDataURL();
				document.querySelector('a').download = 'wallpaper.png';
			}
			
			document.querySelector("button.refresh").addEventListener("click", function(e) {
				e.preventDefault();
				lame();
			});
			
			document.querySelector("input[type=submit]").addEventListener("click", function(e) {
				e.preventDefault();
				
				console.log("Submitted.");
				console.log("Calculating aspect ratio...");
			});
			
			document.querySelectorAll("input[type=number]").forEach(element => {
				element.addEventListener("input", function(e) {
					if (e.target.id === "width") {
						CANVAS_ELEMENT.width = e.target.value;
					}
					else if (e.target.id === "height") {
						CANVAS_ELEMENT.height = e.target.value;
					}
					else if (e.target.id === "boxes") {
						number_of_boxes = e.target.value;
					}
					else if (e.target.id === "circles") {
						number_of_circles = e.target.value;
					}
					
					// console.log(e.target);
				});
			});
			
			document.querySelectorAll("input[type=range]").forEach(element => {
				element.addEventListener("input", function (e) {
					let r = document.querySelector("input[type=range]#red").value;
					let g = document.querySelector("input[type=range]#green").value;
					let b = document.querySelector("input[type=range]#blue").value;
					
					let rgb = "rgb(" + r + ", " + g + ", " + b + ")";
					
					document.querySelector("div.bg-image").style.backgroundColor = rgb;
				});
			});
			
			document.querySelector('input[type=checkbox]').addEventListener("change", function (e) {
				if (e.target.checked) {
					// console.log("Checked.");
					interval = setInterval(lame, 100);
				}
				else {
					// console.log("Not checked.");
					clearInterval(interval);
				}
			});
		</script>
	</body>
</html>